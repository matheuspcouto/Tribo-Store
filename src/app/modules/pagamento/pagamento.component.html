<div *ngIf="loading">
  <app-loadder></app-loadder>
</div>

<section class="h-100 mt-3 section mb-3" *ngIf="!loading">
  <div class="container h-100">
    <div class="row justify-content-md-center h-100">
      <div class="card-wrapper">
        <div class="card fat">
          <div class="card-body" style="background-color: white">

            <a routerLink="/meu-carrinho">
              <button type="button" class="btn btnVoltar text-center">
                <i class="fa fa-arrow-left float-left"></i> Voltar
              </button>
            </a><br>

            <div class="divImg mt-3">
              <img src="assets/logo.png" class="img" />
            </div>
            <h2 class="card-title text-center mt-3" id="titulo">
              Pagamento
            </h2>
            <hr />

            <form id="form-checkout" class="my-login-validation" action="POST" *ngIf="form == 'cartao'">
              <div class="form-group">
                <label>Número do Cartão</label>
                <input id="cardNumber" type="text" name="cardNumber" [(ngModel)]="dadosCartao.cardNumber" class="form-control"
                  required mask="0000 0000 0000 0000" />
                <div *ngIf="errorsValidators">
                  <div *ngFor="let erro of errorsValidators">
                    <p class="label-error" *ngIf="erro.controleErro === 'numero_cartao'">{{erro.mensagemErro}}</p>
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="form-group">
                  <label>Vencimento</label>
                  <input id="expirationDate" type="text" name="expirationDate" [(ngModel)]="dadosCartao.expirationDate" class="form-control" required mask="00/00" />
                  <div *ngIf="errorsValidators">
                    <div *ngFor="let erro of errorsValidators">
                      <p class="label-error" *ngIf="erro.controleErro === 'vencimento'">{{erro.mensagemErro}}</p>
                    </div>
                  </div>
                </div>
                <div class="form-group">
                  <label>CVV</label>
                  <input id="securityCode" type="number" name="securityCode" [(ngModel)]="dadosCartao.securityCode" class="form-control" required />
                  <div *ngIf="errorsValidators">
                    <div *ngFor="let erro of errorsValidators">
                      <p class="label-error" *ngIf="erro.controleErro === 'cvv'">{{erro.mensagemErro}}</p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label>Titular do Cartão</label>
                <input id="cardholderName" type="text" class="form-control" name="cardholderName" [(ngModel)]="dadosCartao.cardholderName" required />
                <div *ngIf="errorsValidators">
                  <div *ngFor="let erro of errorsValidators">
                    <p class="label-error" *ngIf="erro.controleErro === 'vencimento'">{{erro.mensagemErro}}</p>
                  </div>
                </div>
              </div>

              <div class="row" *ngIf="bandeiras">
                <label>Bandeira</label>
                <div class="form-group col-sm-12">
                  <div class="form-group">
                    <select class="form-select form-select-lg" required name="bandeira"
                      [(ngModel)]="bandeiraSelecionada">
                      <option *ngFor="let bandeira of bandeiras; let i = index" [ngValue]="bandeira">
                        {{ bandeira.name }}
                      </option>
                    </select>
                    <div *ngIf="errorsValidators">
                      <div *ngFor="let erro of errorsValidators">
                        <p class="label-error" *ngIf="erro.controleErro === 'formasPagamento'">{{erro.mensagemErro}}</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row" *ngIf="parcelas">
                <label>Parcelas</label>
                <div class="form-group col-sm-12">
                  <div class="form-group">
                    <select class="form-select form-select-lg" name="installments" required id="installments" [(ngModel)]="dadosCartao.installments">
                      <option *ngFor="let parcela of parcelas.data; let i = index" [ngValue]="parcela">
                        {{ parcela }}
                      </option>
                    </select>
                    <div *ngIf="errorsValidators">
                      <div *ngFor="let erro of errorsValidators">
                        <p class="label-error" *ngIf="erro.controleErro === 'parcelas'">{{erro.mensagemErro}}</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-group m-0">
                <button (click)="criarPagamentoCartao()" type="button" class="btn btn-success btn-block">
                  Realizar Pagamento
                </button>
              </div>

            </form>

            <div *ngIf="form == 'pix'">

              <h4 class="card-title text-center mt-3">QR Code</h4>
              <img class="qrCode mt-3" *ngIf="dadosPix" [src]="'data:image/jpeg;base64,' + dadosPix.qr_code_base64" />
              <p class="card-title text-center mt-3" id="codigoPedido">{{ dadosPix?.qr_code }}</p>
              <a class="btn btn-block mb-5" (click)="copiarCodigo($event)"><i class="fa fa-copy"></i> Copiar</a>

              <div class="form-group m-0" *ngIf="dadosPix">
                <a [href]="dadosPix.ticket_url" target="_blank" type="button" class="btn btn-success btn-block">
                  Pagar com Pix
                </a>
              </div>
            </div>

            <hr />
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
